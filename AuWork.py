#‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
#  ‚ñà‚ñÄ‚ÄÉ‚ñà ‚ñà‚ÄÉ‚ñÄ‚ñÑ‚ñÄ‚ÄÉ ‚ÄÉ‚ñà‚ñÄ‚ñÑ‚ñÄ‚ñà‚ÄÉ‚ñà‚ñÄ‚ñà‚ÄÉ‚ñà‚ñÄ‚ñÑ‚ÄÉ‚ñà ‚ñà‚ÄÉ‚ñà  ‚ÄÉ‚ñà‚ñÄ‚ñÄ‚ÄÉ‚ñà‚ñÄ Chanel: https://t.me/mescr_m
#  ‚ñÑ‚ñà‚ÄÉ‚ñà‚ñÄ‚ñà‚ÄÉ‚ñà ‚ñà‚ÄÉ ‚ÄÉ‚ñà ‚ñÄ ‚ñà‚ÄÉ‚ñà‚ñÑ‚ñà‚ÄÉ‚ñà‚ñÑ‚ñÄ‚ÄÉ‚ñà‚ñÑ‚ñà‚ÄÉ‚ñà‚ñÑ‚ñÑ‚ÄÉ‚ñà‚ñà‚ñÑ‚ÄÉ‚ñÑ‚ñà Not Licensed
#‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
# Idea:
# meta developer: @mescr_m
# Thanks: 
#‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî

from .. import loader, utils
import asyncio
from asyncio import sleep
import inspect
from ..inline.types import InlineCall

__version__ = (1, 2, ' Cycle Update')

class AuWork(loader.Module):
    '''–ú–æ–¥—É–ª—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ /work –≤ –±–æ—Ç–µ @good_biznesbot\nDeveloper: @mescr_m'''
    strings = {
        'name':'AuWork',
        'time':'–ü–µ—Ä–µ–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ "–†–∞–±–æ—Ç–∞" –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏.\n–£–∫–∞–∑—ã–≤–∞–π—Ç–µ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.',
        'dtime':'–ü–µ—Ä–µ–æ–¥–∏—á–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã. –£–∫–∞–∑—ã–≤–∞–π—Ç–µ –≤ –º–∏–Ω—É—Ç–∞—Ö',
        'autostart':'–ó–∞–ø—É—Å–∫–∞—Ç—å –ª–∏ –º–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —é–∑–µ—Ä–±–æ—Ç–∞?',
        'autodelete':'–£–¥–∞–ª—è—Ç—å –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∞—Ç, –µ—Å–ª–∏ –±–æ—Ç –Ω–µ —Å–º–æ–≥ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?'
    }

    def __init__(self):
        self.config = loader.ModuleConfig(
            loader.ConfigValue(
                "time", 3,
                lambda: self.strings("time"),
                validator=loader.validators.Integer()
            ),
            loader.ConfigValue(
                "dtime", 70,
                lambda: self.strings("dtime"),
                validator=loader.validators.Integer(minimum = 60)
            ),
            loader.ConfigValue(
                "autostart", False,
                lambda: self.strings("autostart"),
                validator=loader.validators.Boolean()
            ),
            loader.ConfigValue(
                "autodelete", True,
                lambda: self.strings("autodelete"),
                validator=loader.validators.Boolean()
            ),
        )

    async def client_ready(self):
            self.set('status', False) if self.get('status') == None else None
            self.set('groups', []) if self.get('groups') is None else None
            if self.get('module_start') == None:
                self.set('module_start', 1)
                await self.module_start_1()
            if self.config['autostaart'] == True:
                if self.get('status') == True:
                    await self.work()
            else:
                self.set('status', False)
                self.set('fact_status', False)  

    async def module_start_1(self):
        zxc = await self.client.send_message('me', f'üåò | AuWorkStart...')
        await self.inline.form(
            text = '–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª—è AuWork. –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–π–¥–µ–º—Å—è –ø–æ –æ—Å–Ω–æ–≤–∞–º –º–æ–¥—É–ª—è?',
            message=zxc,
            reply_markup=[
                [
                    {
                        "text": "‚ö° –ù–∞—á–∞—Ç—å",
                        "callback": self.cmd_status,
                    },
                ],
                [
                    {
                        "text": "‚ùå –ù–µ—Ç",
                        "action": 'close',
                    },
                ],
            ],
        )

    @loader.command()
    async def workgroup(self, message):
        '''[ ID –≥—Ä—É–ø–ø—ã / –Ω–∏—á–µ–≥–æ ] - –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É –¥–ª—è —Ä–∞–±–æ—Ç—ã'''
        error_cmd = f'{utils.escape_html(self.get_prefix())}{inspect.currentframe().f_code.co_name}'
        args = utils.get_args_raw(message)
        if args:
            if args[:1] == '-':
                if args[1:].isdigit():
                    group = int(args)
                    groups = self.get('groups')
                    try:
                        group_info = await self.client.get_entity(group)
                        groupname = group_info.title
                    except Exception:
                        groupname = '[ <u>GroupTitleError</u> ]'
                    if group not in groups:
                        self.get('groups').append(group)
                        await utils.answer(message, f'<emoji document_id=5332533929020761310>‚úÖ</emoji> | –ì—Ä—É–ø–ø–∞ <u>{groupname}</u> (<code>{group}</code>) —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ AuWork.')
                        return
                    else:
                        self.get('groups').remove(group)
                        await utils.answer(message, f'<emoji document_id=5332533929020761310>‚úÖ</emoji> | –ì—Ä—É–ø–ø–∞ <u>{groupname}</u> (<code>{group}</code>) —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ AuWork.')
                        return
                else:
                    await utils.asnwer(message, f'<emoji document_id=5877477244938489129>üö´</emoji> <b>Error</b> | <code>{error_cmd}</code>\n–í ID –≥—Ä—É–ø–ø –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∏—á–µ–≥–æ, –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä.')
                    return
            else:
                await utils.asnwer(message, f'<emoji document_id=5877477244938489129>üö´</emoji> <b>Error</b> | <code>{error_cmd}</code>\nID –≥—Ä—É–ø–ø –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å <code>-</code>.')
                return
        else:
            if message.is_private != True:
                group = message.chat_id
                try:
                    group_info = await self.client.get_entity(group)
                    groupname = group_info.title
                except Exception:
                    groupname = '[ <u>GroupTitleError</u> ]'
                groups = self.get('groups')
                if group not in groups:
                    self.get('groups').append(group)
                    await utils.answer(message, f'<emoji document_id=5332533929020761310>‚úÖ</emoji> | –ì—Ä—É–ø–ø–∞ <u>{groupname}</u> (<code>{group}</code>) —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ AuWork.')
                    return
                else:
                    self.get('groups').remove(group)
                    await utils.answer(message, f'<emoji document_id=5332533929020761310>‚úÖ</emoji> | –ì—Ä—É–ø–ø–∞ <u>{groupname}</u> (<code>{group}</code>) —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ AutWork.')
                    return
            else:
                await utils.answer(message, f'<emoji document_id=5877477244938489129>üö´</emoji> <b>Error</b> | <code>{error_cmd}</code>\n–î–ª—è —Ä–∞–±–æ—Ç—ã –º–æ–≥—É—Ç –ø–æ–¥–æ–π—Ç–∏ —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—ã.')
                return
            
    @loader.command()
    async def auwork(self, message):
        '''- –≤—ã–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å AuWork'''
        if self.get('status') == True:
            self.set('status', False)
            await utils.answer(message, f'<emoji document_id=5332533929020761310>‚úÖ</emoji> | AuWork –≤—ã–∫–ª—é—á–µ–Ω.')
            return
        else:
            self.set('status', True)
            txt = f'<emoji document_id=5332533929020761310>‚úÖ</emoji> | AuWork –≤–∫–ª—é—á–µ–Ω.'
            if self.get('fact_status') == False:
                txt += f'\n<emoji document_id=5327790373865530387>üîó</emoji> | –¶–∏–∫–ª –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω.'
            await utils.answer(message, txt)
            if self.get('fact_status') == False:
                await self.work()
            return
        
    async def work(self):
        while True:
            await asyncio.sleep(0.5)
            if self.get('status') == True:
                self.set('fact_status', True)
                groups = self.get('groups')
                time = self.config['time']
                dtime = self.config['dtime'] * 60
                for group in groups:
                    try:
                        await self.client.send_message(group, '–†–∞–±–æ—Ç–∞')
                    except Exception:
                        txt = f'<emoji document_id=5393507664166660007>‚õì</emoji> | –í–∞—à —é–∑–µ—Ä–±–æ—Ç –Ω–µ —Å–º–æ–≥ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤ –≥—Ä—É–ø–ø–µ ID:<code>{group}</code>, –≤–µ—Ä–æ—è—Ç–Ω–æ, –í–∞—Å —Ç–∞–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –∏–ª–∏ –≤—ã–¥–∞–ª–∏ –º—É—Ç.'
                        if self.config['autodelete']:
                            self.get('groups').remove(group)
                            txt += '\n\n<emoji document_id=5444961247818691184>üß°</emoji> | –≠—Ç–∞ –≥—Ä—É–ø–ø–∞ –±—ã–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –≥—Ä—É–ø–ø –¥–ª—è —Ä–∞–±–æ—Ç—ã.'
                        await self.client.send_message('me', txt)
                    finally:
                        await asyncio.sleep(time)
                await asyncio.sleep(dtime)
            else:
                self.set('fact_status', False)
                break

    @loader.command()
    async def workgroups(self, message):
        '''- –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≥—Ä—É–ø–ø—ã AuWork'''
        await utils.answer(message, '<emoji document_id=5307773751796964107>‚è≥</emoji> | –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...')
        groups = self.get('groups')
        num = 0
        txt = ''
        for group in groups:
            try:
                group_info = await self.client.get_entity(group)
                groupname = group_info.title
            except Exception:
                groupname = '[ <u>GroupTitleError</u> ]'
            num += 1
            txt += f'{num} | {groupname} (<code>{group}</code>)\n'
        await utils.answer(message, f'<emoji document_id=5936283232780684228>üë•</emoji> | –ì—Ä—É–ø–ø—ã AuWork:\n{txt}')

    async def cmd_status(self,  call: InlineCall):
        await call.answer('1/3 —Å—Ç—Ä–∞–Ω–∏—Ü–∞.')
        txt = '–•–æ—Ä–æ—à–æ, –Ω–∞—á–Ω–µ–º —Å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã: <code>.auwork</code>, —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤–∫–ª—é—á–∞—Ç—å –∏ –æ—Ç–∫–ª—é—á–∞—Ç—å –º–æ–¥—É–ª—å.'
        await call.edit(
            text=txt,
            reply_markup=[
                [
                    {
                        "text": "‚ö° –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å",
                        "callback": self.cmd_group,
                    },
                ],
                [
                    {
                        "text": "‚ùå –ó–∞–∫–æ–Ω—á–∏—Ç—å",
                        "action": 'close',
                    },
                ]
            ]
        )

    async def cmd_group(self,  call: InlineCall):
        await call.answer('2/3 —Å—Ç—Ä–∞–Ω–∏—Ü–∞.')
        time = self.get('time')
        txt = f'–°–ª–µ–¥—É—â–∞—è –∫–æ–º–∞–Ω–¥–∞: <code>.workgroup</code>, —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –≤—ã —Å–º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –≥—Ä—É–ø–ø—ã –º–æ–¥—É–ª—è. –í –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã –º–æ–¥—É–ª—å –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–π —á–∞—Å —Å–æ–æ–±—â–µ–Ω–∏–µ "/work", –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–¥–Ω—É –≥—Ä—É–ø–ø—É, –±–æ—Ç –ø–æ–¥–æ–∂–¥–µ—Ç <code>{time}</code> —Å–µ–∫, –∞ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–ª–µ–¥—É—é—â—É—é –≥—Ä—É–ø–ø—É.\n–î–æ–±–∞–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –≥—Ä—É–ø–ø—ã –º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:\n\n<b><u>–°–ø–æ—Å–æ–± 1</u></b>:\n–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Ç—É –≥—Ä—É–ø–ø—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å.\n\n<b><u>–°–ø–æ—Å–æ–± 2:</u></b>\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ ID –≥—Ä—É–ø–ø—ã, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å, –Ω–æ –ø–æ–º–Ω–∏—Ç–µ, ID –≤—Å–µ—Ö –≥—Ä—É–ø–ø –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å <code>-</code>.'
        await call.edit(
            text=txt,
            reply_markup=[
                [
                    {
                        "text": "‚ö° –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å",
                        "callback": self.cmd_time,
                    },
                ],
                [
                    {
                        "text": "‚ùå –ó–∞–∫–æ–Ω—á–∏—Ç—å",
                        "action": 'close',
                    },
                ]
            ]
        )

    async def cmd_time(self,  call: InlineCall):
        await call.answer('3/3 —Å—Ç—Ä–∞–Ω–∏—Ü–∞.')
        time = self.get('time')
        txt = f'–°–ª–µ–¥—É—â–∞—è –∫–æ–º–∞–Ω–¥–∞: <code>.worktime</code>. –°–µ–π—á–∞—Å –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–æ–π /work –≤ –∫–∞–∂–¥—É—é –≥—Ä—É–ø–ø—É: <code>{time}</code>, —Ç–æ –µ—Å—Ç—å, –æ—Ç–ø—Ä–∞–≤–∏–≤ <code>/work</code> –≤ –æ–¥–Ω—É –≥—Ä—É–ø–ø—É, –±–æ—Ç –ø–æ–¥–æ–∂–¥–µ—Ç <code>{time}</code> —Å–µ–∫, –∞ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç –∫–æ–º–∞–Ω–¥—É –≤ —Å–ª–µ–¥—É—é—â—É—é –≥—Ä—É–ø–ø—É.'
        await call.edit(
            text=txt,
            reply_markup=[
                [
                    {
                        "text": "‚ö° –ó–∞–∫–æ–Ω—á–∏—Ç—å",
                        'action':'close',
                    },
                ],
            ]
        )
